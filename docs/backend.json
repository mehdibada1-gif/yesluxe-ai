{
  "entities": {
    "Property": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Property",
      "type": "object",
      "description": "Represents a property managed within the Concierge AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Property entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the property."
        },
        "address": {
          "type": "string",
          "description": "Address of the property."
        },
        "amenities": {
          "type": "array",
          "description": "List of amenities offered at the property.",
          "items": {
            "type": "string"
          }
        },
        "rules": {
          "type": "string",
          "description": "House rules for the property."
        },
        "experienceIds": {
          "type": "array",
          "description": "References to Experiences offered at the property. (Relationship: Property 1:N Experience)",
          "items": {
            "type": "string"
          }
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to the Owner of the property. (Relationship: Owner 1:N Property)"
        },
        "mediaUrls": {
          "type": "array",
          "description": "URLs of media (images, videos) associated with the property.",
          "items": {
            "type": "string"
          }
        },
        "qrCode": {
          "type": "string",
          "description": "QR code associated with the property for easy access."
        },
        "bookingLinks": {
          "type": "array",
          "description": "Booking links for the property",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "ownerId"
      ]
    },
    "Owner": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Owner",
      "type": "object",
      "description": "Represents an owner of properties within the Concierge AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Owner entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the owner."
        },
        "email": {
          "type": "string",
          "description": "Email address of the owner.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    },
    "Client": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Client",
      "type": "object",
      "description": "Represents a client interacting with the Concierge AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Client entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the client."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a chat message within the Concierge AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ChatMessage entity."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to the Property the message is related to. (Relationship: Property 1:N ChatMessage)"
        },
        "clientId": {
          "type": "string",
          "description": "Reference to the Client sending the message. (Relationship: Client 1:N ChatMessage)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "Content of the chat message."
        },
        "isAgent": {
          "type": "boolean",
          "description": "Boolean to identify whether the message came from the bot/AI assistant"
        }
      },
      "required": [
        "id",
        "propertyId",
        "clientId",
        "timestamp",
        "content"
      ]
    },
    "Experience": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Experience",
      "type": "object",
      "description": "Represents an experience or tour that can be booked through the Concierge AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Experience entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the experience."
        },
        "description": {
          "type": "string",
          "description": "Description of the experience."
        },
        "location": {
          "type": "string",
          "description": "Location where the experience takes place."
        },
        "bookingLink": {
          "type": "string",
          "description": "Link to book the experience."
        },
        "propertyId": {
          "type": "string",
          "description": "Reference to the Property the message is related to. (Relationship: Property 1:N Experience)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "location",
        "bookingLink"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "owners/{ownerId}",
        "definition": {
          "entityName": "Owner",
          "schema": {
            "$ref": "#/backend/entities/Owner"
          },
          "description": "Stores information about property owners. The {ownerId} is the Firebase Auth UID.",
          "params": [
            {
              "name": "ownerId",
              "description": "The unique identifier for the owner (Firebase Auth UID)."
            }
          ]
        }
      },
      {
        "path": "properties/{propertyId}",
        "definition": {
          "entityName": "Property",
          "schema": {
            "$ref": "#/backend/entities/Property"
          },
          "description": "Stores information about properties. Includes 'ownerId' for authorization.",
          "params": [
            {
              "name": "propertyId",
              "description": "The unique identifier for the property."
            }
          ]
        }
      },
      {
        "path": "clients/{clientId}",
        "definition": {
          "entityName": "Client",
          "schema": {
            "$ref": "#/backend/entities/Client"
          },
          "description": "Stores information about clients.",
          "params": [
            {
              "name": "clientId",
              "description": "The unique identifier for the client."
            }
          ]
        }
      },
      {
        "path": "chat_messages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages, indexed by message ID. Includes propertyId and clientId.",
          "params": [
            {
              "name": "chatMessageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "experiences/{experienceId}",
        "definition": {
          "entityName": "Experience",
          "schema": {
            "$ref": "#/backend/entities/Experience"
          },
          "description": "Stores information about experiences.",
          "params": [
            {
              "name": "experienceId",
              "description": "The unique identifier for the experience."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Concierge AI platform, prioritizing authorization independence, clarity, and scalability. The core principle is to avoid hierarchical authorization dependencies by denormalizing relevant data and using structural segregation to maintain a homogeneous security posture within each collection.\n\n**Authorization Independence and DBAC (Database-Based Access Control):**  Access control is managed through explicit field values rather than relying on hierarchical `get()` calls.  The `ownerId` field in `properties` is crucial for direct ownership checks, removing the need to traverse to an `owners` collection to verify ownership. Roles are managed via the database, specifically through path-based ownership and membership maps (if collaboration features are extended). The absence of custom claims simplifies the security rules and debugging process. The structure facilitates atomic operations because authorization checks do not depend on retrieving parent documents.\n\n**QAPs (Rules Are Not Filters) and Structural Segregation:** The structure promotes secure list operations.  By placing each entity type into its own collection (e.g., `properties`, `owners`, `clients`, `chat_messages`, `experiences`), we ensure that security rules can be applied consistently across all documents within each collection.  There's no mixing of data with differing access requirements within the same collection. For example, public vs. private property listings would reside in separate collections if such a distinction was needed. \n\n**Data Clarity and Predictability:**  The schema emphasizes explicit state modeling (e.g., using a `status` field instead of inferring state), predictable schemas (avoiding dynamic keys), and radical consistency in naming conventions.  Standardized authorization fields (e.g., `ownerId`) and descriptive wildcards (e.g., `{propertyId}`) improve debuggability and maintainability.\n\n**Invariants:** The structure supports data integrity by clearly defining ownership (using `ownerId` in `properties`) and relationships (e.g., a Property has many Experiences via the `experiences` subcollection). Timestamps for chat messages are stored directly within the `chat_messages` documents. Denormalized data is used where necessary to ensure authorization independence (e.g., owner information copied into property documents, if required by future features)."
  }
}